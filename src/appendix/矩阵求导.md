### Definition 1

对于单变量线性函数 $f(x)=ax$​​​, $f'(x)=a$​，为了前后的连续性我们使用偏导符号
$$
\frac{\partial{f}}{\partial{x}} = a
$$
对于多变量线性函数$f(x)=a^Tx=\sum_{i}a_{i}x_{i}$​​​​，$a,x$​​为(列)向量，有：
$$
\frac{\partial{f}}{\partial{x_k}}=\frac{\part{\sum_ia_ix_i}}{\part{x_k}}=a_k \forall k=1,\cdots,n
$$
我们定义**标量函数对向量的求导**为下：
$$
\frac{\part{f}}{\part{x}}=[\frac{\part{f}}{\part{x_1}},\frac{\part{f}}{\part{x_2}},\cdots,\frac{\part{f}}{\part{x_n}}]^T =[a_1,a_2,\cdots,a_n]^T=a
$$
广义:
$$
\frac{\part{f}}{\part{x}}=
\left[\begin{array}{ccc}
\frac{\partial f}{\partial x_{11}}& \cdots & \frac{\partial f}{\partial x_{1n}}\\
\vdots & \ddots & \vdots \\
\frac{\partial f}{\partial x_{m1}}& \cdots & \frac{\partial f}{\partial x_{mn}}\\
\end{array}\right]
$$

### Theorem 1

对于多元标量函数$f(x)=a^Tx$，$\frac{\part{f}}{\part{x}}=a$​.

Proposition: 由于标量的值等于它的迹。对于$g(x)=Tr[a^Tx]$​​, $\frac{\part{g}}{\part{x}}=a$​​.

### Properties 1

Definition of Trace: $Tr[A]=\sum_iA_{ii}$，根据定义，矩阵的迹有以下的性质：

1. $Tr[A+B]=Tr[A]+Tr[B]$​
2. $Tr[cA]=cTr[A]$
3. $Tr[A]=Tr[A^T]$
4. $Tr[A_1 A_2 \cdots A_n]=Tr[A_n A_1 \cdots A_{n-1}]$​
5. $Tr[A^T B]=\sum_i\sum_jA_{ij}B_{ij}$

### Theorem 2

对于多元标量函数$f(x)=Tr[A^{T}x]$​，有$\frac{\part{f}}{\part{x}}=A \quad \forall A,x\in \mathbb{R}^{m\times n}$​。

利用Properties 1(5)易证。

### Tips

对于任意的标量函数$f:\mathbb{R}^{m\times n}\rightarrow \mathbb{R}$，有$\frac{\part{f}}{\part{x}}=\frac{\part{Tr[x]}}{\part{x}}$。然后可以利用Properties 1中的性质，进行变换，化成Theorem 2的形式。

### Definition 2

定义矩阵微分（differential）如下：
$$
\differential A=
\left[\begin{array}{ccc}
\differential A_{11}& \cdots & \differential A_{1n}\\
\vdots & \ddots & \vdots \\
\differential A_{m1}& \cdots & \differential A_{mn}\\
\end{array}\right]
$$

### Theorem 3

根据迹的定义和Definition 2可得：
$$
\differential Tr[A] = Tr[\differential A]
$$

### Theorem 4

对于标量函数$f:\mathbb{R}^{m\times n}\rightarrow \mathbb{R}$​，$\differential f=Tr[(\frac{\part{f}}{\part{x}})^T\differential x]$​​. （建立了**矩阵微分**和**矩阵求导**之间的关系）

证明：$LHS=\differential f=\sum_{ij}\frac{\part{f}}{\part{x_{ij}}}\differential x_{ij}$​

依次利用Properties 1、Definition 2、Definition 1：$RHS = \sum_{ij}(\frac{\part{f}}{\part{x}})_{ij}(\differential x)_{ij}=\sum_{ij}(\frac{\part{f}}{\part{x}})_{ij}\differential x_{ij}=\sum_{ij}\frac{\part{f}}{\part{x_{ij}}}\differential x_{ij}=LHS$

### Properties 2

利用Definition 2，可以得到矩阵微分的性质：

1. $\differential(cA)=c\differential A$
2. $\differential(A+B)=\differential A + \differential B$
3. $\differential(AB)=\differential AB+A\differential B$

### Conclusion 1

自此，对于标量函数$f:\mathbb{R}^{m\times n}\rightarrow \mathbb{R}$​，我们能够通过以下流程轻易对其求导：

1. $\differential f=\differential Tr[x]=Tr[\differential x]$​
2. 利用迹的性质Properties 1对$\differential f$​进行化简，化简成$Tr[A^T dx]$​​​​形式的线性相加.
3. 利用Theorem 4，得到$\frac{\part{f}}{\part{x}}$​.

### Examples

1. $f(x)=x^TAx, A\in\mathbb{R}^{n \times n},x\in \mathbb{R}^n$​​

$$
\differential f=\differential Tr[x^TAx]=Tr[\differential(x^TAx)]=Tr[d(x^T)Ax+x^TAdx]=Tr[d(x^T)Ax]+Tr[x^TAdx]\\
=Tr[x^TA^Tdx]+Tr[x^TAdx]=Tr[(x^TA^T+x^TA)dx]
$$

​	Hence,
$$
\frac{\part{f}}{\part{x}}=(x^TA^T+x^TA)^T=(A+A^T)x
$$

2. $XX^{-1}=I\to\differential(XX^{-1})=\differential I \to \differential XX^{-1}+X\differential X^{-1} \to \differential X^{-1}=-X^{-1}\differential XX^{-1}$

### Definition 3

上面总结了scalar函数对x的求导。下面定义vector函数对向量x的求导：

对于vector函数$f=[f_1,f_2,\dots,f_n]^T$​​，$f_i=f_i(x), x=[x_1,x_2,\dots,x_m]^T$​​，我们定义:
$$
\frac{\part{f}}{\part{x}}=
\left[\begin{array}{cccc}
\frac{\partial f_1}{\partial x_{1}}& \frac{\partial f_2}{\partial x_{1}} & \cdots & \frac{\partial f_n}{\partial x_{1}}\\
\frac{\partial f_1}{\partial x_{2}} & \frac{\partial f_2}{\partial x_{2}}  & \cdots & \frac{\partial f_n}{\partial x_{2}}  \\
\vdots & \vdots & \ddots & \vdots \\
\frac{\partial f_1}{\partial x_{m}}& \frac{\partial f_2}{\partial x_{m}}& \cdots & \frac{\partial f_n}{\partial x_{m}}\\
\end{array}\right]
$$

### Hessian Matrix and Jacobian Matrix

假设$f:\mathbb{R}^m \to \mathbb{R}^n$，$f$的Jacobian Matrix为
$$
J(f)=[\frac{\part{f}}{\part{x_1}} \cdots\frac{\part{f}}{\part{x_m}}]=
\left[\begin{array}{ccc}
\frac{\partial f_1}{\partial x_{1}}& \cdots & \frac{\partial f_1}{\partial x_{m}}\\
\vdots & \ddots & \vdots \\
\frac{\partial f_n}{\partial x_{1}}& \cdots & \frac{\partial f_n}{\partial x_{m}}\\
\end{array}\right]
$$
假设$f:\mathbb{R}^m \to \mathbb{R}$​，$f$​​的Hessian Matrix为
$$
H(f)={\begin{bmatrix}{\frac {\partial ^{2}f}{\partial x_{1}^{2}}}&{\frac {\partial ^{2}f}{\partial x_{1}\,\partial x_{2}}}&\cdots &{\frac {\partial ^{2}f}{\partial x_{1}\,\partial x_{m}}}\\\\{\frac {\partial ^{2}f}{\partial x_{2}\,\partial x_{1}}}&{\frac {\partial ^{2}f}{\partial x_{2}^{2}}}&\cdots &{\frac {\partial ^{2}f}{\partial x_{2}\,\partial x_{m}}}\\\\\vdots &\vdots &\ddots &\vdots \\\\{\frac {\partial ^{2}f}{\partial x_{m}\,\partial x_{1}}}&{\frac {\partial ^{2}f}{\partial x_{m}\,\partial x_{2}}}&\cdots &{\frac {\partial ^{2}f}{\partial x_{m}^{2}}}\end{bmatrix}}=J(\nabla f)
$$
根据Definition 3，我们可以把Hessian Matrix和Jacobian Matrix重写为：
$$
J(f)=(\frac{\part{f}}{\part{x}})^T\\
H(f)=\frac{\part}{\part{x}}(\frac{\part{f}}{\part{x^T}})\\
$$

### Theorem 5

对于$f:\mathbb{R}^{m}\to \mathbb{R}^{n}$​，有$\differential f=(\frac{\part{f}}{\part{x}})^T\differential x$​. （证明$\differential f_j=((\frac{\part{f}}{\part{x}})^T\differential x)_j \quad \forall j$​

### Conclusion 2

对于vector函数的求导，整体流程同Conclusion 1，除了不能随便用trace。

